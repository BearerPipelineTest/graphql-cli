(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[154],{5318:function(e,n,a){"use strict";a.d(n,{Zo:function(){return c},kt:function(){return u}});var t=a(7378);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=t.createContext({}),s=function(e){var n=t.useContext(p),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},c=function(e){var n=s(e.components);return t.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=s(a),u=r,h=m["".concat(p,".").concat(u)]||m[u]||d[u]||o;return a?t.createElement(h,i(i({ref:n},c),{},{components:a})):t.createElement(h,i({ref:n},c))}));function u(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return t.createElement.apply(null,i)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},7496:function(e,n,a){"use strict";a.r(n),a.d(n,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return c},default:function(){return m}});var t=a(9603),r=a(120),o=(a(7378),a(5318)),i=["components"],l={id:"migration",title:"Migration",sidebar_label:"Migration"},p=void 0,s={unversionedId:"migration",id:"migration",isDocsHomePage:!1,title:"Migration",description:"Migration from GraphQL CLI 3.x or older",source:"@site/docs/migration.md",sourceDirName:".",slug:"/migration",permalink:"/migration",editUrl:"https://github.com/urigo/graphql-cli/edit/master/website/docs/migration.md",version:"current",frontMatter:{id:"migration",title:"Migration",sidebar_label:"Migration"},sidebar:"docs",previous:{title:"validate",permalink:"/validate"},next:{title:"Custom commands",permalink:"/custom-commands"}},c=[{value:"Migration from GraphQL CLI 3.x or older",id:"migration-from-graphql-cli-3x-or-older",children:[{value:"Install the new version",id:"install-the-new-version",children:[]},{value:"Update your configuration file",id:"update-your-configuration-file",children:[]},{value:"Comparison of old commands",id:"comparison-of-old-commands",children:[]},{value:"Special Notes for Prisma users",id:"special-notes-for-prisma-users",children:[]}]}],d={toc:c};function m(e){var n=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,t.Z)({},d,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"migration-from-graphql-cli-3x-or-older"},"Migration from GraphQL CLI 3.x or older"),(0,o.kt)("p",null,"Starting with GraphQL CLI 4.0 and higher, the way projects are set up is significantly restructured."),(0,o.kt)("h3",{id:"install-the-new-version"},"Install the new version"),(0,o.kt)("p",null,"To get started, install the new version:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"yarn global add graphql-cli\n")),(0,o.kt)("p",null,"You can also globally install using npm."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"NOTE: If you have previous version of the GraphQL-CLI installed make sure to uninstall it first")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm uninstall graphql-cli\n")),(0,o.kt)("h3",{id:"update-your-configuration-file"},"Update your configuration file"),(0,o.kt)("p",null,"If you are working from an existing project, the GraphQL Config file that is used by GraphQL CLI is now called ",(0,o.kt)("inlineCode",{parentName:"p"},".graphqlrc.yml")," (by default) instead of ",(0,o.kt)("inlineCode",{parentName:"p"},".graphqlconfig"),". ",(0,o.kt)("a",{parentName:"p",href:"https://graphql-config.com/usage"},"Other options exist")," for naming the config files supported by GraphQL CLI, but this guide will assume you're using YAML syntax."),(0,o.kt)("p",null,"To migrate, you will first need to update your GraphQL Configuration file to match GraphQL Config's updated syntax and structure."),(0,o.kt)("p",null,"You can ",(0,o.kt)("a",{parentName:"p",href:"https://graphql-config.com/usage"},"check here")," for more information about the new structure."),(0,o.kt)("p",null,"####Specifying schema(s):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"schema: ./src/schema/**/*.graphql #You can have URL endpoint, Git URL and local files using globs here.\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"schemaPath")," is replaced by ",(0,o.kt)("inlineCode",{parentName:"p"},"schema"),", which is now more flexible then the previous approach. This field is used by all commands and plugins of GraphQL CLI."),(0,o.kt)("h3",{id:"comparison-of-old-commands"},"Comparison of old commands"),(0,o.kt)("h4",{id:"get-schema-is-no-longer-available"},(0,o.kt)("inlineCode",{parentName:"h4"},"get-schema")," is no longer available"),(0,o.kt)("p",null,"In previous versions, you were able to download the schema to the given path in ",(0,o.kt)("inlineCode",{parentName:"p"},"schemaPath")," from the URL given inside ",(0,o.kt)("inlineCode",{parentName:"p"},"endpoint"),". In the new version, ",(0,o.kt)("inlineCode",{parentName:"p"},"schema")," refers to the endpoint of the schema."),(0,o.kt)("p",null,"If you use Prisma or any other tool that provides your schema under URL endpoint, you must to specify it using the following syntax in your configuration YAML:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"schema: http://localhost:4000/graphql #This is the schema path\n")),(0,o.kt)("p",null,"If you want to download the schema from this URL to your local file system, you will also need to install ",(0,o.kt)("inlineCode",{parentName:"p"},"codegen")," plugin and its ",(0,o.kt)("inlineCode",{parentName:"p"},"schema-ast")," plugin using the following command or its npm equivalent:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @graphql-cli/codegen @graphql-codegen/schema-ast --dev\n")),(0,o.kt)("p",null,"After that, you can specify the output path of the local schema file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"schema: http://localhost:4000/graphql\nextensions:\n  codegen:\n    generates:\n      ./schema.graphql:\n        plugins:\n          - schema-ast\n")),(0,o.kt)("p",null,"By running ",(0,o.kt)("inlineCode",{parentName:"p"},"graphql codegen"),", the ",(0,o.kt)("inlineCode",{parentName:"p"},"schema.graphql")," file is generated in the root path of your project."),(0,o.kt)("h5",{id:"for-json-output"},"For JSON Output"),(0,o.kt)("p",null,"If you want to download the schema as a ",(0,o.kt)("inlineCode",{parentName:"p"},"json")," introspection file, you will need to install ",(0,o.kt)("inlineCode",{parentName:"p"},"@graphql-codegen/introspection")," instead, and add ",(0,o.kt)("inlineCode",{parentName:"p"},"introspection")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"schema-ast"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"schema: http://localhost:4000/graphql\nextensions:\n  codegen:\n    generates:\n      ./schema.json:\n        plugins:\n          - introspection\n")),(0,o.kt)("h4",{id:"create-is-no-longer-available-it-is-replaced-by-the-init-command"},(0,o.kt)("inlineCode",{parentName:"h4"},"create")," is no longer available: it is replaced by the ",(0,o.kt)("inlineCode",{parentName:"h4"},"init")," command."),(0,o.kt)("p",null,"If you want to create a GraphQL Config file on an existing project or create a project using a template from scratch, you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"graphql init")," command.\nThis command will ask some questions about your new or existing project to update your dependencies and create a new configuration file for GraphQL CLI."),(0,o.kt)("h4",{id:"diff-has-been-changed"},(0,o.kt)("inlineCode",{parentName:"h4"},"diff")," has been changed"),(0,o.kt)("p",null,"If you want to see the differences between your schema and another schema, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"diff")," command as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"graphql diff git:origin/master:schema.graphql\n")),(0,o.kt)("p",null,"For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"diff")," will show the differences between the version in ",(0,o.kt)("inlineCode",{parentName:"p"},"schema")," field of GraphQL Configuration file and the ",(0,o.kt)("inlineCode",{parentName:"p"},"schema.graphql")," file in the remote master branch."),(0,o.kt)("p",null,"Alternatively, you can compare ",(0,o.kt)("inlineCode",{parentName:"p"},"schema")," with a URL endpoint:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"graphql diff http://my-dev-instance.com/graphql\n")),(0,o.kt)("h4",{id:"add-endpoint-add-project-schema-status-ping-query-prepare-lint-and-playground-commands-are-no-longer-available"},(0,o.kt)("inlineCode",{parentName:"h4"},"add-endpoint"),", ",(0,o.kt)("inlineCode",{parentName:"h4"},"add-project"),", ",(0,o.kt)("inlineCode",{parentName:"h4"},"schema-status"),", ",(0,o.kt)("inlineCode",{parentName:"h4"},"ping"),", ",(0,o.kt)("inlineCode",{parentName:"h4"},"query"),", ",(0,o.kt)("inlineCode",{parentName:"h4"},"prepare"),", ",(0,o.kt)("inlineCode",{parentName:"h4"},"lint")," and ",(0,o.kt)("inlineCode",{parentName:"h4"},"playground")," commands are no longer available."),(0,o.kt)("p",null,"GraphQL CLI (as well as GraphQL Config) no longer separates ",(0,o.kt)("inlineCode",{parentName:"p"},"endpoints")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"schemaPath"),". The new ",(0,o.kt)("inlineCode",{parentName:"p"},"schema")," field refers to the single endpoint of your GraphQL schema, so it can be a URL endpoint or a local file. If your project uses a remote schema, you can directly define this URL in ",(0,o.kt)("inlineCode",{parentName:"p"},"schema")," path without downloading it or defining it as an extra ",(0,o.kt)("inlineCode",{parentName:"p"},"endpoint")," etc."),(0,o.kt)("p",null,"Instead of using these legacy commands, you can create a faked server to test your schema using the ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn serve")," command."),(0,o.kt)("h4",{id:"codegen-now-uses-graphql-code-generator"},(0,o.kt)("inlineCode",{parentName:"h4"},"codegen")," now uses GraphQL Code Generator"),(0,o.kt)("p",null,"GraphQL CLI now uses GraphQL Code Generator which has a lot of plugins and templates for various environments, platforms and use cases. You can generate resolver signatures, TypeScript representations of your GraphQL Schema and more. ",(0,o.kt)("a",{parentName:"p",href:"https://graphql-code-generator.com/"},"Check it out")),(0,o.kt)("p",null,"The usage is slightly different from the old one:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"schema: src/schema/**/*.graphql\nextensions:\n    codegen:\n        src/generated-types.ts: # Output file name\n            - typescript # Plugin names to be used\n            - typescript-resolvers\n")),(0,o.kt)("p",null,"For instance, consider a hypothetical case where you need to generate TypeScript resolvers signatures for your GraphQL project. To do this, you would install the ",(0,o.kt)("inlineCode",{parentName:"p"},"codegen")," plugin and the additional plugins and templates for GraphQL Code Generator. For this case, you would need ",(0,o.kt)("inlineCode",{parentName:"p"},"typescript")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"typescript-resolvers")," plugins:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @graphql-cli/codegen @graphql-codegen/typescript @graphql-codegen/typescript-resolvers --dev\n")),(0,o.kt)("p",null,"Now, using a single command, you can run GraphQL Code Generator using GraphQL CLI:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"graphql codegen\n")),(0,o.kt)("h3",{id:"special-notes-for-prisma-users"},"Special Notes for Prisma users"),(0,o.kt)("p",null,"Prisma users will need to download a schema from a URL endpoint. For example, here is a ",(0,o.kt)("em",{parentName:"p"},"legacy GraphQL Config file")," doing this:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},".graphqlconfig")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"projects:\n  app:\n    schemaPath: src/schema.graphql\n    extensions:\n      endpoints:\n        default: http://localhost:4000\n  database:\n    schemaPath: src/generated/prisma-client/prisma.graphql\n    extensions:\n      prisma: prisma/prisma.yml\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"To update the configuration for the new GraphQL CLI")," you need to rename the file to ",(0,o.kt)("inlineCode",{parentName:"p"},".graphqlrc.yml"),", and then update the file as follows:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},".graphqlrc.yml")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"projects:\n  app:\n    schema: src/schema.graphql\n  database:\n    schema: prisma/prisma.yml\n    extensions:\n      codegen:\n        generates:\n          ./src/generated/prisma-client/prisma.graphql:\n            plugins:\n              - schema-ast\n")),(0,o.kt)("p",null,"You can directly point to your ",(0,o.kt)("inlineCode",{parentName:"p"},"prisma.yml")," file instead of the URL endpoint."),(0,o.kt)("p",null,"Before running the GraphQL CLI command to use this new configuration, make sure you have installed the ",(0,o.kt)("inlineCode",{parentName:"p"},"@graphql-cli/codegen")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"@graphql-codegen/schema-ast")," plugins using:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"yarn add @graphql-cli/codegen @graphql-codegen/schema-ast --dev\n")),(0,o.kt)("p",null,"Now you can run ",(0,o.kt)("inlineCode",{parentName:"p"},"graphql codegen --project database")," for generating your ",(0,o.kt)("inlineCode",{parentName:"p"},"prisma.graphql")," file."),(0,o.kt)("p",null,"You will also need to update your ",(0,o.kt)("inlineCode",{parentName:"p"},"prisma.yml")," file if you're using ",(0,o.kt)("inlineCode",{parentName:"p"},"graphql get-schema")," with Prisma:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"...\n## Ensures Prisma client is re-generated after a datamodel change.\nhooks:\n  post-deploy:\n    - graphql codegen --project database # instead of graphql get-schema\n    - prisma generate\n")))}m.isMDXComponent=!0}}]);